//script Quest_Warehousewarfare_
//text gText_Warehousewarfare_
const FLAG_HIDE_BARGE_GUARD = FLAG_TEMP_1

script Quest_Warehousewarfare_Interact_Event_Script{
    lock
    faceplayer

    goto_if_quest_active(QUEST_WAREHOUSEWARFARE,Quest_Warehousewarfare_Active_Dialogue)
    goto_if_quest_reward(QUEST_WAREHOUSEWARFARE,Quest_Warehousewarfare_Reward_Dialogue)
    goto_if_quest_complete(QUEST_WAREHOUSEWARFARE,Quest_Warehousewarfare_Complete_Dialogue)

    goto(Quest_Warehousewarfare_Welcome_Dialogue)
}

script Quest_Warehousewarfare_CallPlayer_Dialogue{
    call(Common_EventScript_PhoneRinging)
    msgbox(gText_Warehousewarfare_HeyIsThisPlayer,,,,PHONE_ON)
    msgbox(gText_Warehousewarfare_WeReallyAppreciate,,,,PHONE_ON)
    msgbox(gText_Warehousewarfare_WedLoveToWorkWith,,,,PHONE_ON)
    closemessage
    playse(SE_POKENAV_HANG_UP)
    startquest(QUEST_WAREHOUSEWARFARE)
    release
    end
}

script Quest_Warehousewarfare_Welcome_Dialogue{
    msgbox(gText_Warehousewarfare_WelcomeTo,MSGBOX_NPC)
    end
}


script Quest_Warehousewarfare_Active_Dialogue{

    lock
    msgbox(gText_Warehousewarfare_GoodToSee,MSGBOX_NPC)

    if (!flag(FLAG_QUEST_WAREHOUSE_WARFARE_EXPLAINED)){
        setflag(FLAG_QUEST_WAREHOUSE_WARFARE_EXPLAINED)
        goto(Quest_Warehousewarfare_ExplainBarges_Dialogue)
    }

    specialvar(VAR_RESULT,Quest_Warehousewarfare_CountRemainingSubquests)

        switch(var(VAR_RESULT)){
            case 3: goto(Quest_Warehousewarfare_ExplainBarge1_Dialogue)
            case 2: goto(Quest_Warehousewarfare_ExplainBarge2_Dialogue)
            case 1: goto(Quest_Warehousewarfare_ExplainBarge3_Dialogue)
            default: return
        }
}

script Quest_Warehousewarfare_ExplainBarges_Dialogue{
    msgbox(gText_Warehousewarfare_WeveBeenStudying)
    msgbox(gText_Warehousewarfare_ThereAreAFewThings)
    msgbox(gText_Warehousewarfare_TheBargesAreAlways)
    msgbox(gText_Warehousewarfare_TheWorkersArePoorlyPaid)
    msgbox(gText_Warehousewarfare_WeWantToFree)
    closemessage

    goto(Quest_Warehousewarfare_Active_Dialogue)
}

//PSF TODO get GetAbnormalWeatherMapNameAndType working to move the barges on the water routes

script Quest_Warehousewarfare_ExplainBarge1_Dialogue{
    msgbox(gText_Warehousewarfare_WeGotSomebody)
    msgbox(gText_Warehousewarfare_HeadToOver)
    closemessage
    release
    end
}

script Quest_Warehousewarfare_ExplainBarge2_Dialogue{
    msgbox(gText_Warehousewarfare_NewsHasPickedUp)
    msgbox(gText_Warehousewarfare_GoDownTo)
    closemessage
    release
    end
}

script Quest_Warehousewarfare_ExplainBarge3_Dialogue{
    msgbox(gText_Warehousewarfare_TheyveMovedAll)
    msgbox(gText_Warehousewarfare_OddlyEnough)
    closemessage
    release
    end
}

script Quest_Warehousewarfare_Reward_Dialogue{
    msgbox(gText_Warehousewarfare_HolyMoly,MSGBOX_NPC)
    completequest(QUEST_WAREHOUSEWARFARE)
    release
    end
}

script Quest_Warehousewarfare_Complete_Dialogue{
    msgbox(gText_Warehousewarfare_ThanksAgain,MSGBOX_NPC)
    end
}

script Quest_Warehousewarfare_Barge1Guard_Visibility_Script{
    returnqueststate(QUEST_WAREHOUSEWARFARE)

    if(var(VAR_RESULT) > QUEST_MENU_UNLOCK_QUEST){
        setflag(FLAG_HIDE_BARGE_GUARD)
    }
    return
}

script Quest_Warehousewarfare_Barge2Guard_Visibility_Script{
    returnqueststate(QUEST_WAREHOUSEWARFARE)

        if(var(VAR_RESULT) > QUEST_MENU_UNLOCK_QUEST){
            specialvar(VAR_RESULT,Quest_Warehousewarfare_CountRemainingSubquests)
                if (var(VAR_RESULT) < 3){
                    setflag(FLAG_HIDE_BARGE_GUARD)
                }
        }
    return
}

script Quest_Warehousewarfare_Barge3Guard_Visibility_Script{
    returnqueststate(QUEST_WAREHOUSEWARFARE)

        if(var(VAR_RESULT) > QUEST_MENU_UNLOCK_QUEST){
            specialvar(VAR_RESULT,Quest_Warehousewarfare_CountRemainingSubquests)
                if (var(VAR_RESULT) < 2){
                    setflag(FLAG_HIDE_BARGE_GUARD)
                }
        }
    return
}

script Quest_Warehousewarfare_Guard_Dialogue{
    msgbox(gText_Warehousewarfare_YouAreNotAuthorized,MSGBOX,NPC)
    release
    end
}

text gText_Warehousewarfare_WelcomeTo{
    format("Welcome to the Shopkeepers Union!")
}

text gText_Warehousewarfare_HeyIsThisPlayer{
    format("Hey, is this {PLAYER}?")
}
text gText_Warehousewarfare_WeReallyAppreciate{
    format("We really appreciate all the work you're doing for the Shopkeepers Union! Most Trainers don't give us the time of day.")
}
text gText_Warehousewarfare_WedLoveToWorkWith{
    format("We've seen your work around the region, and would love to work with you in the future, if you're interested. Can you swing by the Shopkeepers Union HQ in Pacifica? We're right next to the Center.")
}
text gText_Warehousewarfare_HolyMoly{
    format("Holy moly you did it.")
}
text gText_Warehousewarfare_ThanksAgain{
    format("Thanks again!")
}
text gText_Warehousewarfare_GoodToSee{
    format("")
}
text gText_Warehousewarfare_WeveBeenStudying{
    format("")
}
text gText_Warehousewarfare_ThereAreAFewThings{
    format("")
}
text gText_Warehousewarfare_TheBargesAreAlways{
    format("")
}
text gText_Warehousewarfare_TheWorkersArePoorlyPaid{
    format("")
}
text gText_Warehousewarfare_WeWantToFree{
    format("")
}
text gText_Warehousewarfare_WeGotSomebody{
    format("")
}
text gText_Warehousewarfare_HeadToOver{
    format("")
}
text gText_Warehousewarfare_NewsHasPickedUp{
    format("")
}
text gText_Warehousewarfare_GoDownTo{
    format("")
}
text gText_Warehousewarfare_TheyveMovedAll{
    format("")
}
text gText_Warehousewarfare_OddlyEnough{
    format("")
}
text gText_Warehousewarfare_YouAreNotAuthorized{
    format("")
}
