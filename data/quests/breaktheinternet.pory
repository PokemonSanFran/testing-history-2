//gText_Breaktheinternet_
//Quest_Breaktheinternet_

const FLAG_HIDE_WAREHOUSE_GUARD = FLAG_TEMP_2
const FLAG_HIDE_ISMAIL = FLAG_TEMP_1
const FLAG_HIDE_MARIN_GIRL = FLAG_TEMP_7
const FLAG_HIDE_SUNSET_GUY = FLAG_TEMP_7
const FLAG_HIDE_GRUNTS = FLAG_TEMP_2
const FLAG_HIDE_GRUNTS_WAVE_2 = FLAG_TEMP_3
const FLAG_HIDE_TWITTER_CEO = FLAG_TEMP_4

const PLAYER = OBJ_EVENT_ID_PLAYER
const WAREHOUSE_ISMAIL = 1
const WAREHOUSE_GRUNT4 = 5
const WAREHOUSE_GRUNT5 = 6
const WAREHOUSE_TWITTER_CEO = 8
const WAREHOUSE_SLURPUFF = 4

script Quest_Breaktheinternet_CountQuestsAndProgress_Script{
    specialvar(VAR_RESULT,Quest_Breaktheinternet_Count_CompletedSocialMedia) 
        if (var(VAR_RESULT) > 5){
            call(Quest_Breaktheinternet_CallPlayer_Dialogue)
        }
    return
}

script Quest_Breaktheinternet_CallPlayer_Dialogue{
    call(Common_EventScript_PhoneRinging)
        msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL,,,PHONE_ON)
        msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ZOEY,,,PHONE_ON)
        closemessage
        release
        end
}

script Quest_Breaktheinternet_Ismail_Visibility_Script{
    specialvar(VAR_0x8003,Quest_Breaktheinternet_Count_CompletedSocialMedia) 
        specialvar(VAR_0x8004,Quest_Breaktheinternet_CountRemainingSubquests)

        if ((var(VAR_0x8003) < 5) || (var(VAR_0x8004) < 2)){
            setflag(FLAG_HIDE_ISMAIL)
        }
    return
}

script Quest_Breaktheinternet_Ismail_Event_Script{
    goto_if_quest_active(QUEST_BREAKTHEINTERNET,Quest_Breaktheinternet_DescribeQuest_Script)
        goto(Quest_Breaktheinternet_StartQuest_Script)
}

script Quest_Breaktheinternet_StartQuest_Script{
        msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
        startquest(QUEST_BREAKTHEINTERNET)
        msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
        release
        end
}

script Quest_Breaktheinternet_DescribeQuest_Script{
    specialvar(VAR_0x8004,Quest_Breaktheinternet_CountRemainingSubquests)

        if ((var(VAR_0x8004) == QUEST_BREAKTHEINTERNET_SUB_COUNT)){
            goto(Quest_Breaktheinternet_Describe_FirstQuest_Dialogue)
        }else{
            goto(Quest_Breaktheinternet_Describe_SecondQuest_Dialogue)
        }
}

script Quest_Breaktheinternet_Describe_FirstQuest_Dialogue{
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
}

script Quest_Breaktheinternet_Describe_SecondQuest_Dialogue{
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
}

script Quest_Breaktheinternet_Marin_Script{
    specialvar(VAR_RESULT,Quest_Breaktheinternet_CountRemainingSubquests)
        if (var(VAR_RESULT) != 3){
            return
        }
    msgbox(gText_ExpandedPlaceholder_Empty)
        trainerbattle_single(TRAINER_TWITTER1,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty,Quest_Breaktheinternet_Marin_PostBattle_Script)
}

script Quest_Breaktheinternet_Marin_PostBattle_Script{
    lock
        subquestmenu(QUEST_MENU_COMPLETE_QUEST,QUEST_BREAKTHEINTERNET,SUB_QUEST_1)
        msgbox(gText_ExpandedPlaceholder_Empty)
        fadescreen(FADE_TO_BLACK)
        removeobject(VAR_LAST_TALKED)
        fadescreen(FADE_FROM_BLACK)
        goto(Quest_Breaktheinternet_CallAfterFirst_Dialogue)
}

script Quest_Breaktheinternet_Sunset_Script{
    specialvar(VAR_RESULT,Quest_Breaktheinternet_CountRemainingSubquests)
        if (var(VAR_RESULT) != 2){
            return
        }
    trainerbattle_single(TRAINER_TWITTER2,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty,Quest_Breaktheinternet_Sunset_PostBattle_Script)
}

script Quest_Breaktheinternet_Sunset_PostBattle_Script{
    lock
        subquestmenu(QUEST_MENU_COMPLETE_QUEST,QUEST_BREAKTHEINTERNET,SUB_QUEST_2)
        msgbox(gText_ExpandedPlaceholder_Empty)
        fadescreen(FADE_TO_BLACK)
        removeobject(VAR_LAST_TALKED)
        fadescreen(FADE_FROM_BLACK)
        goto(Quest_Breaktheinternet_CallAfterSecond_Dialogue)
}

script Quest_Breaktheinternet_MarinGirl_Visibility_Script{
    subquestmenu(QUEST_MENU_CHECK_COMPLETE,QUEST_BREAKTHEINTERNET,SUB_QUEST_1)

        if (var(VAR_RESULT)){
            setflag(FLAG_HIDE_MARIN_GIRL)
        }

    return
}

script Quest_Breaktheinternet_SunsetGuy_Visibility_Script{
    subquestmenu(QUEST_MENU_CHECK_COMPLETE,QUEST_BREAKTHEINTERNET,SUB_QUEST_2)

        if (var(VAR_RESULT)){
            setflag(FLAG_HIDE_SUNSET_GUY)
        }

    return
}

script Quest_Breaktheinternet_CallAfterFirst_Dialogue{
    lock
    call(Common_EventScript_PhoneRinging)

    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL,,,PHONE_ON)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ZOEY,,,PHONE_ON)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL,,,PHONE_ON)
    closemessage 
    playse(SE_POKENAV_HANG_UP)
    release
    end
}

script Quest_Breaktheinternet_CallAfterSecond_Dialogue{
    lock
    call(Common_EventScript_PhoneRinging)

    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL,,,PHONE_ON)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ZOEY,,,PHONE_ON)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL,,,PHONE_ON)
    closemessage 
    playse(SE_POKENAV_HANG_UP)
    release
    end
}

script Quest_Breaktheinternet_Warehouse_Grunts_Visibility_Script{
    setflag(FLAG_HIDE_GRUNTS)
}

script Quest_Breaktheinternet_Warehouse_Grunts2_Visibility_Script{
    setflag(FLAG_HIDE_GRUNTS_WAVE_2)
    return
}

script Quest_Breaktheinternet_Warehouse_Ismail_Visibility_Script{
    setflag(FLAG_HIDE_ISMAIL)
    return
}

script Quest_Breaktheinternet_Warehouse_CEO_Visibility_Script{
    setflag(FLAG_HIDE_TWITTER_CEO)
    return
}

script Quest_Breaktheinternet_WarehouseGuard_Script{
    specialvar(VAR_RESULT,Quest_Breaktheinternet_CountRemainingSubquests) 
        if (var(VAR_RESULT) < 2){
            setflag(FLAG_HIDE_WAREHOUSE_GUARD)
        }
    return
}

script Quest_Breaktheinternet_EventScript_Grunt1{
    trainerbattle_single(TRAINER_TWITTER3,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty,Quest_Breaktheinternet_EventScript_Grunt1Defeated)
    msgbox(gText_ExpandedPlaceholder_Empty,MSGBOX_AUTOCLOSE)
    end
}

script Quest_Breaktheinternet_EventScript_Grunt1Defeated{
    msgbox(gText_ExpandedPlaceholder_Empty,MSGBOX_DEFAULT)
    release
    end
}

script Quest_Breaktheinternet_EventScript_Grunt2{
    trainerbattle_single(TRAINER_TWITTER4,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty,Quest_Breaktheinternet_EventScript_Grunt2Defeated)
    msgbox(gText_ExpandedPlaceholder_Empty,MSGBOX_AUTOCLOSE)
    end
}

script Quest_Breaktheinternet_EventScript_Grunt2Defeated{
    msgbox(gText_ExpandedPlaceholder_Empty,MSGBOX_DEFAULT)
    release
    end
}

script Quest_Breaktheinternet_SetPlayerPosition_Script{
    getplayerxy(VAR_TEMP_0,VAR_TEMP_1)

        if (var(VAR_TEMP_0) == 1){
            fadescreen(FADE_TO_BLACK)
            setobjectxy(PLAYER,2,8) 
            TeleportCamera(9,9)
            applymovement(PLAYER,Common_Movement_FaceLeft)
            waitmovement(PLAYER)
            fadescreen(FADE_FROM_BLACK)
        }
return
}

script Quest_Breaktheinternet_TriggerWave2Battle1_Script{
    lock
    msgbox(gText_ExpandedPlaceholder_Empty)
    closemessage
    addobject(WAREHOUSE_GRUNT4)
    addobject(WAREHOUSE_GRUNT5)
    applymovement(WAREHOUSE_GRUNT4,Quest_Breaktheinternet_GruntsWalkToPlayer)
    applymovement(WAREHOUSE_GRUNT5,Quest_Breaktheinternet_GruntsWalkToPlayer)
    waitmovement(WAREHOUSE_GRUNT4)
    msgbox(gText_ExpandedPlaceholder_Empty)
    trainerbattle_single(TRAINER_TWITTER5,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty,Quest_Breaktheinternet_Wave2Battle2_Script)
    end
}

script Quest_Breaktheinternet_Wave2Battle2_Script{
    lock
    msgbox(gText_ExpandedPlaceholder_Empty)
    trainerbattle_single(TRAINER_TWITTER6,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty,Quest_Breaktheinternet_CompleteWave2_Script)
}

script Quest_Breaktheinternet_CompleteWave2_Script{
    lock
    msgbox(gText_ExpandedPlaceholder_Empty)
    fadescreen(FADE_FROM_BLACK)
    removeobject(WAREHOUSE_GRUNT4)
    removeobject(WAREHOUSE_GRUNT5)
    fadescreen(FADE_FROM_BLACK)
    release
    end
}

script Quest_Breaktheinternet_StartFinalCutscene_Dialogue{
    lock
    call(Quest_Breaktheinternet_SetPlayerPosition_Script)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ZOEY,TAIL_THOUGHT,EMOTE_SHOCK)
    closemessage
    playmoncry(SPECIES_SLURPUFF,CRY_MODE_WEAK)
    waitse
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ZOEY,TAIL_THOUGHT,EMOTE_SHOCK)
    closemessage
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
    closemessage
playse(SE_PIN)
    applymovement(PLAYER,Common_Movement_ExclamationMark)
    applymovement(WAREHOUSE_SLURPUFF,Common_Movement_ExclamationMark)
waitse
    applymovement(PLAYER,Common_Movement_FaceRight)
    applymovement(WAREHOUSE_SLURPUFF,Quest_Breaktheinternet_SlurpuffMoveToSee)
    waitmovement(PLAYER)
    setvar(VAR_OBJ_GFX_ID_0,OBJ_EVENT_GFX_REPORTER_M)
    addobject(WAREHOUSE_ISMAIL)
    applymovement(WAREHOUSE_ISMAIL,Quest_Breaktheinternet_IsmailWalkToPlayer)
    waitmovement(WAREHOUSE_ISMAIL)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
    closemessage
    applymovement(WAREHOUSE_SLURPUFF,Quest_Breaktheinternet_RunBehindPlayer)
    waitmovement(WAREHOUSE_SLURPUFF)
    playmoncry(SPECIES_SLURPUFF,CRY_MODE_ROAR_2)
    msgbox(gText_ExpandedPlaceholder_Empty)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
    closemessage
//PSF TODO figure out how to do the transform script like Castform in merrp's followers
    removeobject(WAREHOUSE_ISMAIL)
    setvar(VAR_OBJ_GFX_ID_1,OBJ_EVENT_GFX_DITTO_DOLL)
    addobject(WAREHOUSE_ISMAIL)
    msgbox(gText_ExpandedPlaceholder_Empty,,SPEAKER_ISMAIL)
    trainerbattle_single(TRAINER_TWITTER_CEO,gText_ExpandedPlaceholder_Empty,gText_ExpandedPlaceholder_Empty)
    completequest(QUEST_BREAKTHEINTERNET)
}
movement Quest_Breaktheinternet_GruntsWalkToPlayer{
    walk_left * 7
    step_end
}
movement Quest_Breaktheinternet_SlurpuffMoveToSee{
    walk_down
    walk_right
    step_end
}
movement Quest_Breaktheinternet_IsmailWalkToPlayer{
    walk_left * 7
    step_end
}
movement Quest_Breaktheinternet_RunBehindPlayer{
    walk_left
    walk_up
    face_right
    step_end
}
