//gText_Employedeverafter_
//Quest_Employedeverafter_

const PLAYER = OBJ_EVENT_ID_PLAYER
const GUEST_A = 1
const GUEST_B = 2
const OFFICIANT = 3
const BRIDE_A = 4
const BRIDE_MISSING = 5
const GUEST_C = 6

const BRIDE_A_GLDNGTEWILDS = 2
const BRIDE_MISSING_GLDNGTEWILDS = 3

const FLAG_HIDE_BRIDE_A = FLAG_TEMP_1
const FLAG_HIDE_BRIDE_MISSING = FLAG_TEMP_3


const FLAG_HIDE_BRIDE_A_GLDNGTEWILDS = FLAG_TEMP_2
const FLAG_HIDE_BRIDE_MISSING_GLDNGTEWILDS = FLAG_TEMP_3

script Quest_Employedeverafter_MovePlayerIntoPosition_Script{
    getplayerxy(VAR_TEMP_0,VAR_TEMP_1)

        if (var(VAR_TEMP_0) != 19 || (var(VAR_TEMP_1) != 28)){
            fadescreen(FADE_TO_BLACK)
                setobjectxy(PLAYER,19,28)
                TeleportCamera(19,28)
                applymovement(PLAYER,Common_Movement_FaceUp)
                waitmovement(PLAYER)
                fadescreen(FADE_FROM_BLACK)
        }
    goto(Quest_Employedeverafter_StartQuest)
}

script Quest_Employedeverafter_StartQuest{
    lock
    setvar(VAR_QUEST_EMPLOYEDEVERAFTER_STATE,LOOK_FOR_BRIDE)
    msgbox(gText_Employedeverafter_WhyWouldShe,MSGBOX_AUTOCLOSE,SPEAKER_KATHARINA,TAIL_SHOUT,EMOTE_SAD)
    closemessage
    applymovement(BRIDE_A,Quest_Employedeverafter_LeaveAltar_Movement)
    applymovement(PLAYER,Quest_Employedeverafter_WatchBridgeLeave_Movement)
    waitmovement(PLAYER)
    addobject(OFFICIANT)
    applymovement(OFFICIANT,Quest_Employedeverafter_WalkAfterBride_Movement)
    waitmovement(OFFICIANT)
    msgbox(gText_Employedeverafter_WhatAMess,,SPEAKER_OFFICIANT,,EMOTE_SWEAT)
    closemessage
    applymovement(PLAYER,Common_Movement_FaceUp)
    waitmovement(PLAYER)
    msgbox(gText_Employedeverafter_TheBrideGotCold,,SPEAKER_OFFICIANT)
    msgbox(gText_Employedeverafter_EverybodyIsOff,,SPEAKER_OFFICIANT)
    msgbox(gText_Employedeverafter_IHopeSheTurns,,SPEAKER_OFFICIANT)
    closemessage
    call(Quest_Employedeverafter_LockAndHideBride_Script)
    startquest(QUEST_EMPLOYEDEVERAFTER)
    release
    end
}

script Quest_Employedeverafter_FoundBride_Dialogue{
    
}

script Quest_Employedeverafter_LockAndHideBride_Script{
    if (var(VAR_QUEST_EMPLOYEDEVERAFTER_STATE) == LOOK_FOR_BRIDE){
        setobjectxy(BRIDE_A,17,34)
        setobjectxyperm(BRIDE_A,17,34)

        setflag(FLAG_HIDE_BRIDE_MISSING)
    }
return
}

script Quest_Employedeverafter_Palacefienarts_HideBrideMissing_Script{
    if (var(VAR_QUEST_EMPLOYEDEVERAFTER_STATE) != FOUND_RING){
        setflag(FLAG_HIDE_BRIDE_MISSING)
    }
    return
}

script Quest_Employedeverafter_Gldngtewilds_HideBrideMissing_Script{
    returnqueststate(QUEST_EMPLOYEDEVERAFTER)

        if (var(VAR_RESULT) == QUEST_MENU_COMPLETE_QUEST){
            setflag(FLAG_HIDE_BRIDE_MISSING_GLDNGTEWILDS)
        }
    return
}

script Quest_Employedeverafter_Gldngtewilds_HideBrideA_Script{
    if (var(VAR_RESULT) == QUEST_MENU_COMPLETE_QUEST || (var(VAR_QUEST_EMPLOYEDEVERAFTER_STATE) < FOUND_BRIDE)){
        setflag(FLAG_HIDE_BRIDE_A_GLDNGTEWILDS)
    }
    return
}

script Quest_Employedeverafter_Gldngtewilds_PositionBrideA_Script{
    if (var(VAR_QUEST_EMPLOYEDEVERAFTER_STATE) == FOUND_RING){
        setobjectxy(BRIDE_A_GLDNGTEWILDS,42,31)
        setobjectxyperm(BRIDE_A_GLDNGTEWILDS,42,31)
    }
    return
}

script Quest_Employedeverafter_BrideMissing_Interact_Script{
    switch (var(VAR_QUEST_EMPLOYEDEVERAFTER_STATE)){
        case LOOK_FOR_BRIDE: goto(Quest_Employedeverafter_PostBattle_Dialogue)
        case FOUND_BRIDE: goto(Quest_Employedeverafter_WonderAboutRing_Dialogue)
        default: return
}

script Quest_Employedeverafter_BrideA_Interact_Script{
    msgbox(gText_Employedeverafter_ICantBeleive,MSGBOX_NPC,SPEAKER_KATHARINA)
}

script Quest_Employedeverafter_PostBattle_Dialogue{
}

script Quest_Employedeverafter_WonderAboutRing_Dialogue{
    checkitem(ITEM_POWDER_JAR,1)

    if (var(VAR_RESULT)){
        goto(Quest_Employedeverafter_FoundRing_Dialogue)
    }
}

script Quest_Employedeverafter_FoundRing_Dialogue{
    completequest(QUEST_EMPLOYEDEVERAFTER) 
}

movement Quest_Employedeverafter_LeaveAltar_Movement{
    walk_faster_down * 13
    step_end
}
movement Quest_Employedeverafter_WatchBridgeLeave_Movement{
    delay_16
    face_right
    face_down
    step_end
}

movement Quest_Employedeverafter_WalkAfterBride_Movement{
    walk_down * 8
    step_end
}

text gText_Employedeverafter_WhyWouldShe{
    format("")
}
text gText_Employedeverafter_WhatAMess{
    format("")
}
text gText_Employedeverafter_TheBrideGotCold{
    format("")
}
text gText_Employedeverafter_EverybodyIsOff{
    format("")
}
text gText_Employedeverafter_IHopeSheTurns{
    format("")
}
