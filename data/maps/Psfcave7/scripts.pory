const PLAYER = OBJ_EVENT_ID_PLAYER
const PSFELITE1 = 9

mapscripts Psfcave7_MapScripts {
   MAP_SCRIPT_ON_TRANSITION {
    goto(Psfcave7_ExhibitCheck_Script)
   }
}

script Psfcave7_ExhibitCheck_Script {
    if (var(VAR_PSFCAVE7_EXHIBIT_STATE) < 2){
        call(ResetPsfcave7Exhibit_Script)
        removeobject(PSFELITE1)
        end
    }
}

script TheStorySoFar_ExplainExhibit_Dialogue {
    lockall
        applymovement(PLAYER,Common_Movement_FaceRight)
        waitmovement(0)
        msgbox(gText_TheStorySoFar_WelcomeToExhibit)
        closemessage
        setvar(VAR_PSFCAVE7_EXHIBIT_STATE,1)
        applymovement(PLAYER,Common_Movement_WalkUp)
        waitmovement(0)
        releaseall
        end
}

script TheStorySoFar_InteractWithAttendant_Script {
    lockall
        applymovement(8,Common_Movement_FacePlayer)
        goto(TheStorySoFar_Event_Script)
}

script TheStorySoFar_EntranceTrigger_Script {
    lockall
        applymovement(PLAYER,Common_Movement_FaceRight)
        applymovement(8,Common_Movement_FaceLeft)
        goto(TheStorySoFar_Event_Script)
}

script TheStorySoFar_Event_Script {
    waitmovement(0)
        switch(var(VAR_PSFCAVE7_EXHIBIT_STATE)){
            case 0: goto(TheStorySoFar_ExplainExhibit_Dialogue)
            case 1: goto(TheStorySoFar_CheckNumberDefeated_Script)
            case 2: goto(TheStorySoFar_AwardPlayer_Script) 
            case 3: goto(TheStorySoFar_Congratulate_Dialogue)
            case 4: goto(Psfcave7Attendant_HealPlayer_Script)

                    goto(TheStorySoFar_CheckNumberDefeated_Script)
        }
}

script TheStorySoFar_CheckNumberDefeated_Script {
    special(CheckNumPsfcave7ExhibitDefeated)
    lockall 
        msgbox(gText_TheStorySoFar_YoureNotQuiteDone)

        switch (var(VAR_RESULT)) {
            case 0: msgbox(gText_TheStorySoFar_YouNeedToDefeat6)
            case 1: msgbox(gText_TheStorySoFar_YouNeedToDefeat5)
            case 2: msgbox(gText_TheStorySoFar_YouNeedToDefeat4)
            case 3: msgbox(gText_TheStorySoFar_YouNeedToDefeat3)
            case 4: msgbox(gText_TheStorySoFar_YouNeedToDefeat2)
            case 5: msgbox(gText_TheStorySoFar_YouNeedToDefeat1)
        }

    getplayerxy(VAR_TEMP_0,VAR_TEMP_1)
        if (var(VAR_TEMP_0) == 15 && var(VAR_TEMP_1) == 16){
            msgbox(gText_TheStorySoFar_AreYouSure,MSGBOX_YESNO)
                if (var(VAR_RESULT) == NO) {
                    applymovement(PLAYER,Common_Movement_WalkUp)
                } else {
                    applymovement(PLAYER,Common_Movement_WalkDown)
                        call(ResetPsfcave7Exhibit_Script)
                }
            waitmovement(0)
        }

    closemessage
        releaseall
        end
}

script TheStorySoFar_AwardPlayer_Script {
    lockall
        setvar(VAR_PSFCAVE7_EXHIBIT_STATE,3)
        setvar(VAR_PSFCAVE7_STATE,1)
        msgbox(gText_TheStorySoFar_ExcellentWork)
        giveitem(ITEM_MACHO_BRACE,1)
        closemessage
        releaseall
        end
}

script TheStorySoFar_Congratulate_Dialogue {
    lockall
        msgbox(gText_TheStorySoFar_WeHopeYouReturn)
        closemessage
        releaseall
        end
}

script Psfcave7Attendant_HealPlayer_Script {
    lockall
        call(Common_EventScript_OutOfCenterPartyHeal)
        msgbox(gText_TheStorySoFar_IveHealedYourParty)
        call(ResetPsfcave7Exhibit_Script)
        closemessage
        releaseall
        end
}

script ResetPsfcave7Exhibit_Script {
    clearflag(TRAINER_FLAGS_START + TRAINER_ALBERTO)
        clearflag(TRAINER_FLAGS_START + TRAINER_ED)
        clearflag(TRAINER_FLAGS_START + TRAINER_DECLAN)
        clearflag(TRAINER_FLAGS_START + TRAINER_FREDRICK)
        clearflag(TRAINER_FLAGS_START + TRAINER_ZANDER)
        clearflag(TRAINER_FLAGS_START + TRAINER_LEAH)

        if (var(VAR_PSFCAVE7_STATE) < 2){
        setvar(VAR_PSFCAVE7_EXHIBIT_STATE,0)
        }
}


script TheStorySoFar_StartBattle1_Script {
    trainerbattle_single(TRAINER_ALBERTO,gText_TheStorySoFar_IHopeYouDont,gText_TheStorySoFar_SlowDown, TheStorySoFar_RunDefeatedCheck_Script, NO_MUSIC)
        msgbox(gText_TheStorySoFar_DontForgetToStop,MSGBOX_AUTOCLOSE)
}

script TheStorySoFar_ReadSign1_Dialogue {
    msgbox(gText_TheStorySoFar_OriginallyBuiltAsAPrison,MSGBOX_SIGN)
}


script TheStorySoFar_StartBattle2_Script {
    trainerbattle_single(TRAINER_ED,gText_TheStorySoFar_IThinkDefense,gText_TheStorySoFar_NotStrongEnough,TheStorySoFar_RunDefeatedCheck_Script, NO_MUSIC)
        msgbox(gText_TheStorySoFar_TheBestOffense,MSGBOX_AUTOCLOSE)
}

script TheStorySoFar_ReadSign2_Dialogue {
    msgbox(gText_TheStorySoFar_TheCriminalUnderbelly,MSGBOX_SIGN)
}

script TheStorySoFar_StartBattle3_Script {
    trainerbattle_single(TRAINER_DECLAN,gText_TheStorySoFar_TheresSomethingSpecial,gText_TheStorySoFar_ImNotSpecial,TheStorySoFar_RunDefeatedCheck_Script, NO_MUSIC)
        msgbox(gText_TheStorySoFar_ItsHardToDoAnything,MSGBOX_AUTOCLOSE)
}

script TheStorySoFar_ReadSign3_Dialogue {
    msgbox(gText_TheStorySoFar_ThePrisonersBeganToTurn,MSGBOX_SIGN)
}

script TheStorySoFar_StartBattle4_Script {
    trainerbattle_single(TRAINER_FREDRICK,gText_TheStorySoFar_PhysicallyDefensiveMasterpiece,gText_TheStorySoFar_ButLikeTheShip,TheStorySoFar_RunDefeatedCheck_Script,NO_MUSIC)
        msgbox(gText_TheStorySoFar_HumansWillAlwaysFind,MSGBOX_AUTOCLOSE)
}

script TheStorySoFar_ReadSign4_Dialogue {
    msgbox(gText_TheStorySoFar_AsTensionsBetweenThePrisoners,MSGBOX_SIGN)
}

script TheStorySoFar_StartBattle5_Script {
    trainerbattle_single(TRAINER_ZANDER,gText_TheStorySoFar_BrokenBonesHealEasily,gText_TheStorySoFar_SomePeopleNeverRecover,TheStorySoFar_RunDefeatedCheck_Script,NO_MUSIC)
        msgbox(gText_TheStorySoFar_MakingSureToTakeCare,MSGBOX_AUTOCLOSE)
}

script TheStorySoFar_ReadSign5_Dialogue {
    msgbox(gText_TheStorySoFar_TheNaturalDisasterLeft,MSGBOX_SIGN)
}

script TheStorySoFar_StartBattle6_Script {
    trainerbattle_single(TRAINER_LEAH,gText_TheStorySoFar_HowToughAreYou,gText_TheStorySoFar_TurnsOutPrettyTough,TheStorySoFar_RunDefeatedCheck_Script,NO_MUSIC)
        msgbox(gText_TheStorySoFar_IHearVoicesStanding,MSGBOX_AUTOCLOSE)
}

script TheStorySoFar_ReadSign6_Dialogue {
    msgbox(gText_TheStorySoFar_ParksAndRecreation,MSGBOX_SIGN)
}

script TheStorySoFar_RunDefeatedCheck_Script {
    special(CheckNumPsfcave7ExhibitDefeated)
    end
}

script YoungPadawan_Intro_Dialogue {
    lockall
        clearflag(FLAG_HIDE_STORYSOFAR_PSFELITE1)
        addobject(PSFELITE1)
    playbgm(MUS_ENCOUNTER_ELITE_FOUR,TRUE)
    applymovement(PSFELITE1,YoungPadawan_GetOffBoat)
    waitmovement(0)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_WowYouLookTired)

call(Common_EventScript_OutOfCenterPartyHeal)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_DidTheChallenge)

setvar(VAR_0x8000, MUGSHOT_HILDA)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_ThankYou)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_DontMentionIt)
callnative(ClearMugshot)
closemessage

applymovement(PSFELITE1,YoungPadawan_LookAtOcean)
applymovement(PLAYER,YoungPadawan_StepDownWalkBeside)
waitmovement(0)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_LearnALot)

setvar(VAR_0x8000, MUGSHOT_HILDA)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_TheStoryOfTheIsland)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_ThatQuakeWasOne)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_HistoryBooksAreCrazy)
callnative(ClearMugshot)
closemessage

applymovement(PSFELITE1,YoungPadawan_WalkBackToPlayer)
waitmovement(0)
applymovement(PLAYER,Common_Movement_FaceDown)
waitmovement(0)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_MakesYouWonder)

setvar(VAR_0x8000, MUGSHOT_HILDA)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_MakesSenseYeah)

goto(YoungPadawan_StartBattle_Script)
}

script YoungPadawan_StartBattle_Script{

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_YouveGotAGoodSpirit)
callnative(ClearMugshot)
closemessage
trainerbattle_continue_after_lose(TRAINER_SIDNEY,gText_YoungPadawan_DontBeatYourselfUp)
goto(YoungPadawan_PostBattle_Dialogue)
}

script YoungPadawan_PostBattle_Dialogue{
lockall
//setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
//callnative(DrawMugshot)

if (defeated(TRAINER_SIDNEY)){
msgbox(gText_YoungPadawan_DidYouHack)

setvar(VAR_0x8000, MUGSHOT_HILDA)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_GotItYouWon)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_KeepItSecretToo)
callnative(ClearMugshot)
closemessage

giveitem(ITEM_POWER_ANKLET,1)
giveitem(ITEM_POWER_BAND,1)
giveitem(ITEM_POWER_BRACER,1)
giveitem(ITEM_POWER_LENS,1)
giveitem(ITEM_POWER_WEIGHT,1)
giveitem(ITEM_POWER_BELT,1)
}else {
    special(HealPlayerParty)
    msgbox(gText_YoungPadawan_KeepTraining)

setvar(VAR_0x8000, MUGSHOT_HILDA)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_IveNeverBattled)

setvar(VAR_0x8000, MUGSHOT_HILDA)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_YeahTotally)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_UntilThenHeres)
closemessage
callnative(ClearMugshot)
}
giveitem(ITEM_GO_GOGGLES,1)

setvar(VAR_0x8000, MUGSHOT_SHAUNTAL)
callnative(DrawMugshot)
msgbox(gText_YoungPadawan_ThoseCanBeTough)
callnative(ClearMugshot)
closemessage

applymovement(PSFELITE1,YoungPadawan_WalkUpStairs)
fadedefaultbgm
applymovement(PLAYER,YoungPadawan_GetOutOfWay)
waitmovement(0)
removeobject(PSFELITE1)
setvar(VAR_PSFCAVE7_STATE,2)
setvar(VAR_PSFCAVE7_EXHIBIT_STATE,4)
releaseall
end
}

script Psfcave7_ChooseFerryDestination_Script {
    msgbox(gText_WhereWould,MSGBOX_NPC)
    goto(Psfcave7_UnlockedDestinations_Script)
}

script Psfcave7_UnlockedDestinations_Script {
    switch (var(VAR_FERRY_STATE)){
        default:goto(Psfcave7_FerryState0_Script)
    }
}

script Psfcave7_FerryState0_Script {
    multichoicedefault(18,8,PSFCAVE7_FERRY_DESTINATIONS_VER1,0,FALSE)
    call(SlateportCity_Harbor_EventScript_BoardFerry)

    switch (var(VAR_RESULT)){
        case 0: warp(MAP_PSFPLACE13,5,6)
        case 1: warp(MAP_PSFCITY17,3,16)
        case 2: goto(SlateportCity_Harbor_EventScript_CancelDestinationSelect)
        case MULTI_B_PRESSED: goto(SlateportCity_Harbor_EventScript_CancelDestinationSelect)
}
}

movement YoungPadawan_GetOffBoat {
    walk_up * 5
	step_end
}
movement YoungPadawan_StepDownWalkBeside {
	walk_down
	face_left
	step_end
}
movement YoungPadawan_LookAtOcean {
    walk_left * 1
	step_end
}
movement YoungPadawan_WalkBackToPlayer {
    walk_down
    walk_right
    face_up
	step_end
}
movement YoungPadawan_WalkUpStairs {
    walk_up * 7
	step_end
}
movement YoungPadawan_GetOutOfWay {
    walk_left
    delay_16
    walk_right
    face_up
	step_end
}

text gText_YoungPadawan_WowYouLookTired {
format("Wow, you look tired! Let me help.")
}

text gText_YoungPadawan_DidTheChallenge {
format("Did the challenge kick your ass? Those kids are tough.")
}

text gText_YoungPadawan_ThankYou {
format("Thank you!")
}

text gText_YoungPadawan_DontMentionIt {
format("Don't mention it.")
}

text gText_YoungPadawan_LearnALot {
format("Learn a lot up there?")
}

text gText_YoungPadawan_TheStoryOfTheIsland {
format("The story of the island is crazy. And I didn't realize the earthquakes here could be that vicious.")
}

text gText_YoungPadawan_ThatQuakeWasOne {
format("That quake was one for the history books! Shook me to my core.")
}

text gText_YoungPadawan_HistoryBooksAreCrazy {
format("History books are crazy. Losers don't get a pre-release copy to leave their edits in the margins... the winners just say whatever they want, and everybody has to deal with it.")
}

text gText_YoungPadawan_MakesYouWonder {
format("Makes you wonder how committed to accuracy the winners are. Old geezers like me, who were around for the history in the making, have a responsibility to set the record straight. Gotta make sure the truth doesn't get lost, you know?")
}

text gText_YoungPadawan_MakesSenseYeah {
format("Makes sense, yeah. But the government doesn't have any reason to lie, which is a relief.")
}

text gText_YoungPadawan_YouveGotAGoodSpirit {
format("Hah! You got a good spirit. Let's see how long you can hold up against your elders!")
}

text gText_YoungPadawan_DidIUnderestimate {
format("Did I underestimate you?")
}

text gText_YoungPadawan_KidYoureSomethingElse {
format("Kid, you're something else! But it ends here.")
}

text gText_YoungPadawan_DontBeatYourselfUp {
format("Heh, don't beat yourself up. I got at least 50 years on ya.")
}

text gText_YoungPadawan_ThisAintHowItWas {
format("This ain't how it was supposed to go!")
}

text gText_YoungPadawan_DidYouHack {
format("Did you hack the Matrix? Maybe you got REAL lucky on a randomizer run? ... We're gonna pretend I won, okay?")
}

text gText_YoungPadawan_GotItYouWon {
format("Haha got it, you won.")
}

text gText_YoungPadawan_KeepItSecretToo {
format("Keep it secret too. Here, take these.")
}

text gText_YoungPadawan_KeepTraining {
format("Keep training! Once you learn a little bit more about the world, let's battle again.")
}

text gText_YoungPadawan_IveNeverBattled {
format("(I've never battled anybody so strong!)")
}

text gText_YoungPadawan_YeahTotally {
format("Yeah, totally!")
}

text gText_YoungPadawan_UntilThenHeres {
format("Until then, here's a consolation prize.")
}

text gText_YoungPadawan_ThoseCanBeTough {
format("Those can be tough to get if you're not from here. Good luck with the rest of your challenge, {PLAYER}.")
}

text gText_TheStorySoFar_WelcomeToExhibit {
    format("Welcome to the Psfcave7 Exhibit. To learn about the island, you'll need to battle our staff. Trainers who can defeat all six without leaving the park or being defeated will complete the challenge and win a prize! If you leave, you'll need to start the challenge over again.")
}

text gText_TheStorySoFar_YoureNotQuiteDone {
    format("You're not quite done.")
}

text gText_TheStorySoFar_AreYouSure {
    format("Are you sure you want to leave?")
}

text gText_TheStorySoFar_YouNeedToDefeat6 {
    format("You need to defeat six more staff members without leaving to complete the challenge.")
}

text gText_TheStorySoFar_YouNeedToDefeat5 {
    format("You need to defeat five more staff members without leaving to complete the challenge.")
}

text gText_TheStorySoFar_YouNeedToDefeat4 {
    format("You need to defeat four more staff members without leaving to complete the challenge.")
}

text gText_TheStorySoFar_YouNeedToDefeat3 {
    format("You need to defeat three more staff members without leaving to complete the challenge.")
}

text gText_TheStorySoFar_YouNeedToDefeat2 {
    format("You need to defeat two more staff members without leaving to complete the challenge.")
}

text gText_TheStorySoFar_YouNeedToDefeat1 {
    format("You need to defeat one more staff member without leaving to complete the challenge.")
}

text gText_TheStorySoFar_IHopeYouDont {
    format("I hope you don't rush through the plaza here!")
}

text gText_TheStorySoFar_SlowDown {
    format("Slow down!")
}

text gText_TheStorySoFar_DontForgetToStop {
    format("Don't forget to stop and smell the roses.")
}

text gText_TheStorySoFar_OriginallyBuiltAsAPrison {
    format("Psfcave7 was originally built as a prison for Psfregion1's most dangerous criminals. Psfcave7 Prison was nationally praised for its state of the art facilities, forward thinking approach to rehabilitation, and no escape attempts.")
}

text gText_TheStorySoFar_IThinkDefense {
    format("I think the best defense is an overwhelming offense.")
}

text gText_TheStorySoFar_NotStrongEnough {
    format("Not strong enough!")
}

text gText_TheStorySoFar_TheBestOffense {
    format("The best offense is the kind that gets stronger with time.")
}

text gText_TheStorySoFar_TheCriminalUnderbelly {
    format("The Psfregion1 criminal underbelly, using agents within the prison, staged a prison riot. The agents took guards hostage, and demanded that the government turn the island over to the prisoners. This occupation lasted for years, and the demands of the prisoners grew more unreasonable as time went on.")
}

text gText_TheStorySoFar_TheresSomethingSpecial {
    format("There's something special about power in large groups...")
}

text gText_TheStorySoFar_ImNotSpecial {
    format("I'm not special on my own.")
}

text gText_TheStorySoFar_ItsHardToDoAnything {
    format("It's hard to do anything meaningful on your own. We're made to work together!")
}

text gText_TheStorySoFar_ThePrisonersBeganToTurn {
    format("The prisoners began to turn to the citizens of the region for support. One of their most vocal allies was Psfelite2, the strongest member of the Psfregion1 Elite Four. Psfelite2 organized public rallies and marches, demanding for the release of the prisoners into society, citing the need for a different rehabilitation approach.")
}

text gText_TheStorySoFar_PhysicallyDefensiveMasterpiece {
    format("Psfcave7 is a physically defensive masterpiece, isn't it?")
}

text gText_TheStorySoFar_ButLikeTheShip {
    format("But like the ship that couldn't sink...")
}

text gText_TheStorySoFar_HumansWillAlwaysFind {
    format("Humans will always find a way to ruin perfection.")
}

text gText_TheStorySoFar_AsTensionsBetweenThePrisoners {
    format("As tensions between the prisoners, their sympathizers, and the government reached a fever pitch, disaster suddenly struck. An unprecedented earthquake ripped through the eastern seaboard of the region, destroying the structure of the prison. Hundreds were injured, and many were killed.")
}

text gText_TheStorySoFar_BrokenBonesHealEasily {
    format("Broken bones heal easily, but the spirit is a whole other matter.")
}

text gText_TheStorySoFar_SomePeopleNeverRecover {
    format("Some people never recover!")
}

text gText_TheStorySoFar_MakingSureToTakeCare {
    format("Making sure to take care of your soul is important!")
}

text gText_TheStorySoFar_TheNaturalDisasterLeft {
    format("The natural disaster left the prisoners broken and defeated, and they quickly surrendered. The prisoners were charged with conspiracy and instigation, seperated, and sent to different prisons around the nation. Psfcave7 was shut down.")
}

text gText_TheStorySoFar_HowToughAreYou {
    format("How tough are you?")
}

text gText_TheStorySoFar_TurnsOutPrettyTough {
    format("Turns out, pretty tough!")
}

text gText_TheStorySoFar_IHearVoicesStanding {
    format("Sometimes, I hear voices standing here all day.")
}

text gText_TheStorySoFar_ParksAndRecreation {
    format("The Psfregion1 Parks and Recreation has dedicated this plaza to the guards who lost their lives in the disaster and the struggle that divided the region for so long. Late at night, some say you can hear their spirits, still fighting to this day to keep our region safe from criminals.")
}

text gText_TheStorySoFar_ExcellentWork {
    format("Excellent work! For completing the challenge, here is your prize!")
}

text gText_TheStorySoFar_WeHopeYouReturn {
    format("Congratulations! We hope you return for more training!")
}

text gText_TheStorySoFar_IveHealedYourParty {
    format("I've healed your party! You can battle these Trainers as often as you like.")
}

